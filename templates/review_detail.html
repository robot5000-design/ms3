{% extends "base.html" %}
{% block content %}
<div class="container">
    <div class="row">
        <div class="col">
            <a href="#" class="btn btn-secondary go-back">Cancel & Go Back</a>
        </div>
    </div>
    {% if session["user"].lower() == "admin" %}
    <div class="row">
        <div class="col-2">
            <a class="btn btn-primary col-2 call-delete">Delete
                Entry</a>
        </div>
        <div class="col-3">
            <a href="{{ url_for('delete_all', tmdb_id=movie_detail.tmdb_id) }}"
                class="btn btn-danger confirm-delete col-2 offset-2 d-none">Confirm Delete
            </a>
        </div>
    </div>
    {% endif %}
    <div class="row">
        <h1 class="">Reviews for:</h1>
        <div>
            <h2 class="heading">{{ movie_detail.original_title }}</h2>

            {% if movie_detail.release_date == "" %}
            <div>Released: Not available.</div>
            {% else %}
            <div>Released: {{ movie_detail.release_date }}</div>
            {% endif %}
            <div>Overall Rating: {{ overall_rating }} / 5</div>

            {% if movie_detail.poster_path == None %}
            <img src="{{ url_for('static', filename='images/no-image-icon.png') }}" class="review-image" alt="">
            {% else %}
            <img src="{{ tmdb_poster_url }}{{ movie_detail.poster_path }}" class="review-image" alt="">
            {% endif %}
        </div>
        {% if not session.user %}
        <a class="login-modal" href="#" data-bs-toggle="modal" data-bs-target="#logInModal">Please Log-In to submit a
            Review</a>
        {% elif already_reviewed %}
        <div>You've already reviewed this.</div>
        {% else %}
        <a href="{{ url_for('new_review', tmdb_id=movie_detail.tmdb_id, media_type=movie_detail.media_type, page=1) }}"
            class="btn btn-primary">Review This</a>
        {% endif %}

        <div>Most recent reviews first:</div>
        <hr>
        {% for review in reviews %}
        {% if session["user"].lower() == "admin" %}
        <div class="row">
            <a class="btn btn-primary call-delete col-3">Delete
                This Review
            </a>
            <a href="{{ url_for('delete_review', tmdb_id=movie_detail.tmdb_id, user=review.created_by) }}"
                class="btn btn-danger confirm-delete d-none offset-3 col-3">Confirm Delete
            </a>
        </div>
        {% endif %}
        <div>Reviewed by: {{ review.created_by }} {{ review.review_date }}</div>
        <div>{{ review.review }}</div>
        <div>Rating: {{ review.rating }} / 5</div>
        <hr>
        {% endfor %}
    </div>
</div>
{% endblock %}